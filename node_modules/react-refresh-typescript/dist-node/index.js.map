{"version":3,"file":"index.js","sources":["../dist-src/core.js","../dist-src/index.js"],"sourcesContent":["import { isFunctionLike, visitEachChild, } from 'typescript';\n/**\n * Create a ReactRefresh transformer for TypeScript.\n *\n * This transformer should run in the before stage.\n *\n * This transformer requires TypeScript to be at least 4.0.\n */\nexport default function (opts = {}) {\n    const ts = opts.ts;\n    if (!ts)\n        throw new Error('Please provide typescript by options.ts');\n    {\n        const [major] = ts.version.split('.');\n        if (parseInt(major) < 4)\n            throw new Error('TypeScript should be at least 4.0');\n    }\n    return (context) => {\n        const { factory } = context;\n        const refreshReg = factory.createIdentifier(opts.refreshReg || '$RefreshReg$');\n        const refreshSig = factory.createIdentifier(opts.refreshSig || '$RefreshSig$');\n        return (file) => {\n            if (file.isDeclarationFile)\n                return file;\n            const containHooksLikeOrJSX = file.languageVariant === ts.LanguageVariant.JSX || file.text.includes('use');\n            if (!containHooksLikeOrJSX)\n                return file;\n            // TODO: change to scan comment?\n            const globalRequireForceRefresh = file.text.includes('@refresh reset');\n            const topLevelDeclaredName = new Set();\n            // Collect top level local declarations\n            for (const node of file.statements) {\n                if (ts.isFunctionDeclaration(node) && node.name)\n                    topLevelDeclaredName.add(node.name.text);\n                if (ts.isVariableStatement(node)) {\n                    for (const decl of node.declarationList.declarations) {\n                        if (ts.isIdentifier(decl.name)) {\n                            topLevelDeclaredName.add(decl.name.text);\n                        }\n                        // ? skip for deconstructing pattern\n                    }\n                }\n            }\n            // track all JSX usage and transform non-top level hooks\n            const { nextFile, usedAsJSXElement, hooksSignatureMap } = visitDeep(file, topLevelDeclaredName, globalRequireForceRefresh);\n            file = nextFile;\n            return updateStatements(file, (statements) => ts.visitLexicalEnvironment(statements, (node) => visitTopLevel(usedAsJSXElement, hooksSignatureMap, node), context));\n        };\n        // Only visit top level declaration to find possible components\n        function visitTopLevel(usedAsJSXElement, hooksSignatureMap, node) {\n            if (ts.isFunctionDeclaration(node)) {\n                if (!node.name || !node.body)\n                    return node;\n                return [node, ...registerComponent(node.name)];\n            }\n            else if (ts.isVariableStatement(node)) {\n                const deferredStatements = [];\n                const nextDeclarationList = ts.visitEachChild(node.declarationList, (declaration) => {\n                    if (!ts.isVariableDeclaration(declaration))\n                        return declaration;\n                    const init = declaration.initializer;\n                    // Not handle complex declaration. e.g. [a, b] = [() => ..., () => ...]\n                    // or declaration without initializer\n                    if (!ts.isIdentifier(declaration.name) || !init)\n                        return declaration;\n                    const declarationUsedAsJSX = usedAsJSXElement.has(declaration.name.text);\n                    if (declarationUsedAsJSX || isFunctionExpressionLikeOrFunctionDeclaration(init)) {\n                        if (!unwantedComponentLikeDefinition(init)) {\n                            deferredStatements.push(...registerComponent(declaration.name));\n                        }\n                        if (isFunctionExpressionLikeOrFunctionDeclaration(init) && hooksSignatureMap.has(init)) {\n                            /**\n                             * const Comp = () => <Comp />\n                             * const Comp2 = function () { return <Comp /> }\n                             *\n                             * Reserve the function name\n                             *\n                             * See https://tc39.es/ecma262/multipage/ecmascript-language-expressions.html#sec-assignment-operators-runtime-semantics-evaluation\n                             */\n                            // this is a workaround to https://github.com/Jack-Works/react-refresh-transformer/issues/8\n                            // I don't have time to refactor it yet.\n                            let oneShot = false;\n                            const sig = visitEachChild(hooksSignatureMap.get(init), (node) => oneShot\n                                ? node\n                                : isFunctionLike(node)\n                                    ? (oneShot = declaration.name)\n                                    : node, context);\n                            deferredStatements.push(factory.createExpressionStatement(sig));\n                        }\n                        return declaration;\n                    }\n                    if (isHigherOrderComponentLike(init)) {\n                        const { registers, call } = registerHigherOrderComponent(hooksSignatureMap, init, declaration.name.text);\n                        deferredStatements.push(...registers, ...registerComponent(declaration.name));\n                        return factory.updateVariableDeclaration(declaration, declaration.name, undefined, declaration.type, call);\n                    }\n                    return declaration;\n                }, context);\n                return [\n                    factory.updateVariableStatement(node, node.modifiers, nextDeclarationList),\n                    ...deferredStatements,\n                ];\n            }\n            else if (ts.isExportAssignment(node)) {\n                if (isHigherOrderComponentLike(node.expression)) {\n                    const { registers, call } = registerHigherOrderComponent(hooksSignatureMap, node.expression, '%default%');\n                    const temp = createTempVariable();\n                    return [\n                        factory.updateExportAssignment(node, node.modifiers, factory.createAssignment(temp, call)),\n                        createComponentRegisterCall(temp, '%default%'),\n                        ...registers,\n                    ];\n                }\n                else if (isFunctionExpressionLikeOrFunctionDeclaration(node.expression)) {\n                    const expr = hooksSignatureMap.get(node.expression);\n                    if (expr) {\n                        return factory.updateExportAssignment(node, node.modifiers, expr);\n                    }\n                }\n            }\n            return node;\n        }\n        function registerComponent(name) {\n            if (!startsWithLowerCase(name.text)) {\n                const temp = createTempVariable();\n                // uniq = name\n                const assignment = factory.createAssignment(temp, name);\n                // $reg$(uniq, \"name\")\n                return [factory.createExpressionStatement(assignment), createComponentRegisterCall(temp, name.text)];\n            }\n            return [];\n        }\n        /**\n         * Please call isHOCLike before call this function\n         */\n        function registerHigherOrderComponent(hooksSignatureMap, callExpr, nameHint) {\n            // Recursive case, if it is x(y(...)), recursive with y(...) to get inner expr\n            const arg0 = callExpr.arguments[0];\n            if (ts.isCallExpression(arg0)) {\n                const tempVar = createTempVariable();\n                const nextNameHint = nameHint + '$' + printNode(callExpr.expression);\n                const { registers, call: innerResult } = registerHigherOrderComponent(hooksSignatureMap, arg0, nextNameHint);\n                return {\n                    call: factory.updateCallExpression(callExpr, callExpr.expression, void 0, [\n                        factory.createAssignment(tempVar, innerResult),\n                        ...callExpr.arguments.slice(1),\n                    ]),\n                    registers: registers.concat(createComponentRegisterCall(tempVar, nextNameHint)),\n                };\n            }\n            // Base case, it is x(function () {...}) or x(() => ...) or x(Identifier)\n            if (!isFunctionExpressionLikeOrFunctionDeclaration(arg0) && !ts.isIdentifier(arg0)) {\n                throw new Error('This is an error of react-refresh/typescript. Please report this problem: Call isHOC before register it');\n            }\n            if (ts.isIdentifier(arg0))\n                return { call: callExpr, registers: [] };\n            const tempVar = createTempVariable();\n            return {\n                call: factory.updateCallExpression(callExpr, callExpr.expression, void 0, [\n                    factory.createAssignment(tempVar, hooksSignatureMap.get(arg0) || arg0),\n                    ...callExpr.arguments.slice(1),\n                ]),\n                registers: [createComponentRegisterCall(tempVar, nameHint + '$' + printNode(callExpr.expression))],\n            };\n        }\n        function createTempVariable() {\n            const tempVariable = factory.createUniqueName(\"_react_refresh_temp\");\n            context.hoistVariableDeclaration(tempVariable);\n            return tempVariable;\n        }\n        function visitDeep(file, topLevelDeclaredName, globalRequireForceRefresh) {\n            const usedAsJSXElement = new Set();\n            const containingHooksOldMap = new Map();\n            const hooksSignatureMap = new Map();\n            function trackHooks(comp, call) {\n                const arr = containingHooksOldMap.get(comp) || [];\n                arr.push(call);\n                containingHooksOldMap.set(comp, arr);\n            }\n            function visitor(node) {\n                // Collect JSX create info\n                // <abc /> or <abc>\n                if (ts.isJsxOpeningLikeElement(node)) {\n                    const tag = node.tagName;\n                    if (ts.isIdentifier(tag) && !isIntrinsicElement(tag)) {\n                        const name = tag.text;\n                        if (topLevelDeclaredName.has(name))\n                            usedAsJSXElement.add(name);\n                    }\n                    // Not tracking other kinds of tagNames like <A.B /> or <A:B />\n                }\n                else if (isJSXConstructingCallExpr(node)) {\n                    const arg0 = node.arguments[0];\n                    if (arg0 && ts.isIdentifier(arg0)) {\n                        const name = arg0.text;\n                        if (topLevelDeclaredName.has(name))\n                            usedAsJSXElement.add(name);\n                    }\n                }\n                if (isReactHooksCall(node)) {\n                    const parent = findAncestor(node, isFunctionExpressionLikeOrFunctionDeclaration);\n                    if (parent)\n                        trackHooks(parent, node);\n                }\n                const oldNode = node;\n                // Collect hooks\n                node = ts.visitEachChild(node, visitor, context);\n                const hooksCalls = containingHooksOldMap.get(oldNode);\n                if (hooksCalls && isFunctionExpressionLikeOrFunctionDeclaration(node) && node.body) {\n                    const hooksTracker = createTempVariable();\n                    const createHooksTracker = factory.createExpressionStatement(factory.createBinaryExpression(hooksTracker, factory.createToken(ts.SyntaxKind.EqualsToken), factory.createCallExpression(refreshSig, undefined, [])));\n                    // @ts-ignore This is a private API.\n                    context.addInitializationStatement(createHooksTracker);\n                    const callTracker = factory.createCallExpression(hooksTracker, void 0, []);\n                    const nextBody = ts.isBlock(node.body)\n                        ? updateStatements(node.body, (r) => [factory.createExpressionStatement(callTracker), ...r])\n                        : factory.createComma(callTracker, node.body);\n                    const newFunction = updateBody(node, nextBody);\n                    const hooksSignature = hooksCallsToSignature(hooksCalls);\n                    const { force: forceRefresh, hooks: hooksArray } = needForceRefresh(hooksCalls);\n                    const requireForceRefresh = forceRefresh || globalRequireForceRefresh;\n                    if (ts.isFunctionDeclaration(newFunction)) {\n                        if (newFunction.name) {\n                            hooksSignatureMap.set(newFunction, createHooksRegisterCall(hooksTracker, newFunction.name, hooksSignature, requireForceRefresh, hooksArray));\n                        }\n                        node = newFunction;\n                    }\n                    else {\n                        const wrapped = createHooksRegisterCall(hooksTracker, newFunction, hooksSignature, requireForceRefresh, hooksArray);\n                        hooksSignatureMap.set(newFunction, wrapped);\n                        node = newFunction;\n                        // if it is an inner decl, we can update it safely\n                        if (findAncestor(oldNode.parent, ts.isFunctionLike))\n                            node = wrapped;\n                    }\n                }\n                return updateStatements(node, addSignatureReport);\n            }\n            function addSignatureReport(statements) {\n                const next = [];\n                for (const statement of statements) {\n                    // Don't want to do a type guard here cause it is safe\n                    const signatureReport = hooksSignatureMap.get(statement);\n                    next.push(statement);\n                    if (signatureReport)\n                        next.push(factory.createExpressionStatement(signatureReport));\n                }\n                return next;\n            }\n            const nextFile = updateStatements(ts.visitEachChild(file, visitor, context), addSignatureReport);\n            return {\n                nextFile,\n                usedAsJSXElement,\n                hooksSignatureMap,\n            };\n        }\n        function printNode(node) {\n            try {\n                return node.getText();\n            }\n            catch {\n                return '';\n            }\n        }\n        function hooksCallsToSignature(calls) {\n            const signature = calls\n                .map((x) => {\n                let assignTarget = '';\n                if (x.parent && ts.isVariableDeclaration(x.parent)) {\n                    assignTarget = printNode(x.parent.name);\n                }\n                let hooksName = printNode(x.expression);\n                let shouldCaptureArgs = 0; // bit-wise parameter position\n                if (ts.isPropertyAccessExpression(x.expression)) {\n                    const left = x.expression.expression;\n                    if (ts.isIdentifier(left) && left.text === 'React') {\n                        hooksName = printNode(x.expression.name);\n                    }\n                }\n                if (hooksName === 'useState')\n                    shouldCaptureArgs = 1 << 0;\n                else if (hooksName === 'useReducer')\n                    shouldCaptureArgs = 1 << 1;\n                const args = x.arguments.reduce((last, val, index) => {\n                    if ((1 << index) & shouldCaptureArgs) {\n                        if (last)\n                            last += ',';\n                        last += printNode(val);\n                    }\n                    return last;\n                }, '');\n                return `${hooksName}{${assignTarget}${args ? `(${args})` : ''}}`;\n            })\n                .join('\\n');\n            if (opts.emitFullSignatures !== true && opts.hashSignature) {\n                try {\n                    return opts.hashSignature(signature);\n                }\n                catch (e) { }\n            }\n            return signature;\n        }\n        function needForceRefresh(calls) {\n            const externalHooks = [];\n            return {\n                hooks: externalHooks,\n                force: calls.some((x) => {\n                    const ownerFunction = findAncestor(x, isFunctionExpressionLikeOrFunctionDeclaration);\n                    const callee = x.expression;\n                    if (!ownerFunction)\n                        return true;\n                    if (ts.isPropertyAccessExpression(callee)) {\n                        const left = callee.expression;\n                        if (ts.isIdentifier(left)) {\n                            if (left.text === 'React')\n                                return false;\n                            const hasDecl = hasDeclarationInScope(ownerFunction, left.text);\n                            if (hasDecl)\n                                externalHooks.push(callee);\n                            return !hasDecl;\n                        }\n                        return true;\n                    }\n                    else if (ts.isIdentifier(callee)) {\n                        if (isBuiltinHook(callee.text))\n                            return false;\n                        const hasDecl = hasDeclarationInScope(ownerFunction, callee.text);\n                        if (hasDecl)\n                            externalHooks.push(callee);\n                        return !hasDecl;\n                    }\n                    return true;\n                }),\n            };\n        }\n        /**\n         * @param instance The identifier of the sig instance\n         * @param component The binding component\n         * @param signature The signature of the function\n         * @param forceRefresh Does forceRefresh enabled?\n         * @param trackers A list of custom hooks references\n         */\n        function createHooksRegisterCall(instance, component, signature, forceRefresh, trackers) {\n            const args = [component];\n            if (signature.includes('\\n'))\n                args.push(factory.createNoSubstitutionTemplateLiteral(signature, signature));\n            else\n                args.push(factory.createStringLiteral(signature));\n            if (forceRefresh || trackers.length)\n                args.push(forceRefresh ? factory.createTrue() : factory.createFalse());\n            if (trackers.length)\n                args.push(factory.createArrowFunction(void 0, void 0, [], void 0, factory.createToken(ts.SyntaxKind.EqualsGreaterThanToken), factory.createArrayLiteralExpression(trackers)));\n            return factory.createCallExpression(instance, void 0, args);\n        }\n        function createComponentRegisterCall(id, name) {\n            return factory.createExpressionStatement(factory.createCallExpression(refreshReg, void 0, [id, factory.createStringLiteral(name)]));\n        }\n        function updateStatements(node, f) {\n            if (ts.isSourceFile(node)) {\n                const sf = factory.updateSourceFile(node, f(node.statements), node.isDeclarationFile, node.referencedFiles, node.typeReferenceDirectives, node.hasNoDefaultLib, node.libReferenceDirectives);\n                return sf;\n            }\n            if (ts.isCaseClause(node)) {\n                const caseClause = factory.updateCaseClause(node, node.expression, f(node.statements));\n                return caseClause;\n            }\n            if (ts.isDefaultClause(node)) {\n                const defaultClause = factory.updateDefaultClause(node, f(node.statements));\n                return defaultClause;\n            }\n            if (ts.isModuleBlock(node)) {\n                const modBlock = factory.updateModuleBlock(node, f(node.statements));\n                return modBlock;\n            }\n            if (ts.isBlock(node)) {\n                const block = factory.updateBlock(node, f(node.statements));\n                return block;\n            }\n            return node;\n        }\n        function updateBody(node, nextBody) {\n            if (ts.isFunctionDeclaration(node)) {\n                if (!ts.isBlock(nextBody))\n                    throw new TypeError();\n                return factory.updateFunctionDeclaration(node, node.modifiers, node.asteriskToken, node.name, node.typeParameters, node.parameters, node.type, nextBody);\n            }\n            else if (ts.isFunctionExpression(node)) {\n                if (!ts.isBlock(nextBody))\n                    throw new TypeError();\n                return factory.updateFunctionExpression(node, node.modifiers, node.asteriskToken, node.name, node.typeParameters, node.parameters, node.type, nextBody);\n            }\n            else if (ts.isArrowFunction(node)) {\n                return factory.updateArrowFunction(node, node.modifiers, node.typeParameters, node.parameters, node.type, node.equalsGreaterThanToken, nextBody);\n            }\n            return node;\n        }\n    };\n    function isBuiltinHook(hookName) {\n        switch (hookName) {\n            case 'useState':\n            case 'useReducer':\n            case 'useEffect':\n            case 'useLayoutEffect':\n            case 'useMemo':\n            case 'useCallback':\n            case 'useRef':\n            case 'useContext':\n            case 'useImperativeHandle':\n            case 'useDebugValue':\n            case 'useTransition':\n            case 'useDeferredValue':\n                return true;\n            default:\n                return false;\n        }\n    }\n    function hasDeclarationInScope(node, name) {\n        while (node) {\n            if (ts.isSourceFile(node) && hasDeclaration(node.statements, name))\n                return true;\n            if (ts.isBlock(node) && hasDeclaration(node.statements, name))\n                return true;\n            node = node.parent;\n        }\n        return false;\n    }\n    // This function does not consider uncommon and unrecommended practice like declare use var in a inner scope\n    function hasDeclaration(nodes, name) {\n        for (const node of nodes) {\n            if (ts.isVariableStatement(node)) {\n                for (const decl of node.declarationList.declarations) {\n                    // binding pattern not checked\n                    if (ts.isIdentifier(decl.name) && decl.name.text === name)\n                        return true;\n                }\n            }\n            else if (ts.isImportDeclaration(node)) {\n                const clause = node.importClause;\n                const defaultImport = clause && clause.name;\n                const namedImport = clause && clause.namedBindings;\n                if (defaultImport && defaultImport.text === name)\n                    return true;\n                if (namedImport && ts.isNamespaceImport(namedImport)) {\n                    if (namedImport.name.text === name)\n                        return true;\n                }\n                else if (namedImport && ts.isNamedImports(namedImport)) {\n                    const hasBinding = namedImport.elements.some((x) => x.name.text === name);\n                    if (hasBinding)\n                        return true;\n                }\n            }\n            else if (ts.isFunctionDeclaration(node)) {\n                if (!node.body)\n                    continue;\n                if (node.name && node.name.text === name)\n                    return true;\n            }\n        }\n        return false;\n    }\n    function isIntrinsicElement(id) {\n        return id.text.includes('-') || startsWithLowerCase(id.text) || id.text.includes(':');\n    }\n    function isImportOrRequireLike(expr) {\n        if (!ts.isCallExpression(expr))\n            return false;\n        const callee = expr.expression;\n        if (callee.kind === ts.SyntaxKind.ImportKeyword)\n            return true;\n        if (ts.isIdentifier(callee) && callee.text.includes('require'))\n            return true;\n        return false;\n    }\n    function isReactHooksCall(expr) {\n        if (!ts.isCallExpression(expr))\n            return false;\n        const callee = expr.expression;\n        if (ts.isIdentifier(callee) && callee.text.startsWith('use'))\n            return true;\n        if (ts.isPropertyAccessExpression(callee) && callee.name.text.startsWith('use'))\n            return true;\n        return false;\n    }\n    function findAncestor(node, callback) {\n        while (node) {\n            const result = callback(node);\n            if (result === 'quit') {\n                return undefined;\n            }\n            else if (result) {\n                return node;\n            }\n            node = node.parent;\n        }\n        return undefined;\n    }\n    /**\n     * If it return true, don't track it even it is used as JSX component\n     */\n    function unwantedComponentLikeDefinition(expr) {\n        if (isImportOrRequireLike(expr))\n            return true;\n        // `const A = B.X` or `const A = X`\n        if (ts.isIdentifier(expr) || ts.isPropertyAccessExpression(expr))\n            return true;\n        if (ts.isConditionalExpression(expr))\n            return (unwantedComponentLikeDefinition(expr.condition) ||\n                unwantedComponentLikeDefinition(expr.whenFalse) ||\n                unwantedComponentLikeDefinition(expr.whenTrue));\n        return false;\n    }\n    function isHigherOrderComponentLike(outExpr) {\n        let expr = outExpr;\n        if (!ts.isCallExpression(outExpr))\n            return false;\n        while (ts.isCallExpression(expr) && !isImportOrRequireLike(expr)) {\n            const callee = expr.expression;\n            // x.y() or x()\n            const isValidCallee = ts.isPropertyAccessExpression(callee) || ts.isIdentifier(callee);\n            if (isValidCallee) {\n                expr = expr.arguments[0]; // check if arg is also a HOC\n                if (!expr)\n                    return false;\n            }\n            else\n                return false;\n        }\n        const isValidHOCArg = isFunctionExpressionLikeOrFunctionDeclaration(expr) ||\n            (ts.isIdentifier(expr) && !startsWithLowerCase(expr.text));\n        return isValidHOCArg;\n    }\n    function isFunctionExpressionLikeOrFunctionDeclaration(node) {\n        if (ts.isFunctionDeclaration(node))\n            return true;\n        if (ts.isArrowFunction(node))\n            return true;\n        if (ts.isFunctionExpression(node))\n            return true;\n        return false;\n    }\n    /**\n     * If the call expression seems like \"jsx(...)\" or \"xyz.jsx(...)\"\n     */\n    function isJSXConstructingCallExpr(call) {\n        if (!ts.isCallExpression(call))\n            return false;\n        const callee = call.expression;\n        let f = '';\n        if (ts.isIdentifier(callee))\n            f = callee.text;\n        if (ts.isPropertyAccessExpression(callee))\n            f = callee.name.text;\n        if (['createElement', 'jsx', 'jsxs', 'jsxDEV'].includes(f))\n            return true;\n        return false;\n    }\n}\nfunction startsWithLowerCase(str) {\n    return str[0].toLowerCase() === str[0];\n}\n","// Node wrapper\nimport core from './core';\nimport typescript from 'typescript';\nimport crypto from 'crypto';\nconst nodeWrapper = function (option = {}) {\n    return core({\n        ts: typescript,\n        hashSignature: (signature) => crypto.createHash('sha1').update(signature).digest('base64'),\n        ...option,\n    });\n};\n// Our build tool chain doesn't allow use to write export = nodeWrapper\nObject.assign(nodeWrapper, { default: nodeWrapper });\nmodule.exports = nodeWrapper;\nmodule.exports.__esModule = true;\n// Give it a correct typing\nexport default nodeWrapper;\n"],"names":["opts","ts","Error","major","version","split","parseInt","context","factory","refreshReg","createIdentifier","refreshSig","file","isDeclarationFile","containHooksLikeOrJSX","languageVariant","LanguageVariant","JSX","text","includes","globalRequireForceRefresh","topLevelDeclaredName","Set","node","statements","isFunctionDeclaration","name","add","isVariableStatement","decl","declarationList","declarations","isIdentifier","nextFile","usedAsJSXElement","hooksSignatureMap","visitDeep","updateStatements","visitLexicalEnvironment","visitTopLevel","body","registerComponent","deferredStatements","nextDeclarationList","visitEachChild","declaration","isVariableDeclaration","init","initializer","declarationUsedAsJSX","has","isFunctionExpressionLikeOrFunctionDeclaration","unwantedComponentLikeDefinition","push","oneShot","sig","get","isFunctionLike","createExpressionStatement","isHigherOrderComponentLike","registers","call","registerHigherOrderComponent","updateVariableDeclaration","undefined","type","updateVariableStatement","modifiers","isExportAssignment","expression","temp","createTempVariable","updateExportAssignment","createAssignment","createComponentRegisterCall","expr","startsWithLowerCase","assignment","callExpr","nameHint","arg0","arguments","isCallExpression","tempVar","nextNameHint","printNode","innerResult","updateCallExpression","slice","concat","tempVariable","createUniqueName","hoistVariableDeclaration","containingHooksOldMap","Map","trackHooks","comp","arr","set","visitor","isJsxOpeningLikeElement","tag","tagName","isIntrinsicElement","isJSXConstructingCallExpr","isReactHooksCall","parent","findAncestor","oldNode","hooksCalls","hooksTracker","createHooksTracker","createBinaryExpression","createToken","SyntaxKind","EqualsToken","createCallExpression","addInitializationStatement","callTracker","nextBody","isBlock","r","createComma","newFunction","updateBody","hooksSignature","hooksCallsToSignature","force","forceRefresh","hooks","hooksArray","needForceRefresh","requireForceRefresh","createHooksRegisterCall","wrapped","addSignatureReport","next","statement","signatureReport","getText","_unused","calls","signature","map","x","assignTarget","hooksName","shouldCaptureArgs","isPropertyAccessExpression","left","args","reduce","last","val","index","join","emitFullSignatures","hashSignature","e","externalHooks","some","ownerFunction","callee","hasDecl","hasDeclarationInScope","isBuiltinHook","instance","component","trackers","createNoSubstitutionTemplateLiteral","createStringLiteral","length","createTrue","createFalse","createArrowFunction","EqualsGreaterThanToken","createArrayLiteralExpression","id","f","isSourceFile","sf","updateSourceFile","referencedFiles","typeReferenceDirectives","hasNoDefaultLib","libReferenceDirectives","isCaseClause","caseClause","updateCaseClause","isDefaultClause","defaultClause","updateDefaultClause","isModuleBlock","modBlock","updateModuleBlock","block","updateBlock","TypeError","updateFunctionDeclaration","asteriskToken","typeParameters","parameters","isFunctionExpression","updateFunctionExpression","isArrowFunction","updateArrowFunction","equalsGreaterThanToken","hookName","hasDeclaration","nodes","isImportDeclaration","clause","importClause","defaultImport","namedImport","namedBindings","isNamespaceImport","isNamedImports","hasBinding","elements","isImportOrRequireLike","kind","ImportKeyword","startsWith","callback","result","isConditionalExpression","condition","whenFalse","whenTrue","outExpr","isValidCallee","isValidHOCArg","str","toLowerCase","nodeWrapper","option","core","_objectSpread","typescript","crypto","createHash","update","digest","Object","assign","default","module","exports","__esModule"],"mappings":"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"}